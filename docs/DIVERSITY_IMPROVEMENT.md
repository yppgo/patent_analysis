# 方案多样性改进

## 问题

每次运行系统时，Strategist 生成的方案都很相似，主要是：
- Step 1: LDA 主题建模
- Step 2: ABOD 异常检测
- Step 3: TF-IDF 关键词提取

## 原因分析

### 1. Temperature 过低
- 当前设置：`temperature=0.3`
- 影响：输出更加确定性，缺少随机性和创造性

### 2. Prompt 示例过于具体
- 问题：示例中直接给出了 "LDA主题建模"、"ABOD异常检测" 等具体方法
- 影响：LLM 倾向于直接复制示例，而不是根据用户目标创新设计

### 3. 缺少多样性引导
- 问题：Prompt 中没有明确鼓励 LLM 探索不同的分析方法
- 影响：LLM 倾向于使用最常见的方法

## 改进方案

### 改进 1：提高 Temperature

**修改文件：** `src/utils/llm_client.py`

```python
# 之前
temperature: float = 0.3

# 之后
temperature: float = 0.7  # 提高到 0.7，增加多样性
```

**效果：**
- 增加输出的随机性和创造性
- 每次运行可能生成不同的方案

### 改进 2：增加方法选项提示

**修改文件：** `src/agents/strategist.py`

**之前：**
```
2. 每个脚本是完全独立的，明确：
   - 方法: 具体算法（如：KMeans聚类、ABOD异常检测）
```

**之后：**
```
2. **鼓励创新**：根据用户目标选择最合适的方法，不要局限于常见方法。可以考虑：
   - 文本分析：LDA、NMF、BERTopic、Word2Vec、TF-IDF
   - 聚类：KMeans、DBSCAN、层次聚类、谱聚类
   - 异常检测：ABOD、Isolation Forest、LOF、One-Class SVM
   - 网络分析：共现网络、引用网络、技术演化路径
   - 时间序列：趋势分析、突变检测、周期性分析
   - 其他创新方法
```

**效果：**
- 提供多种方法选项，激发 LLM 的创造性
- 根据用户目标选择最合适的方法组合

### 改进 3：抽象化示例

**之前（过于具体）：**
```json
{
  "step_id": 1,
  "objective": "对专利进行主题分类",
  "method": "LDA主题建模",
  "algorithm": "Latent Dirichlet Allocation"
}
```

**之后（更抽象）：**
```json
{
  "step_id": 1,
  "objective": "步骤1的目标（根据用户需求设计）",
  "method": "选择合适的方法名称",
  "algorithm": "具体算法名称"
}
```

**效果：**
- 减少示例对 LLM 的影响
- 鼓励 LLM 根据用户目标自主设计

## 预期效果

### 之前
用户目标：分析技术空白
- Step 1: LDA 主题建模
- Step 2: ABOD 异常检测
- Step 3: TF-IDF 关键词提取

### 之后（可能的多样化方案）

**方案 A：基于网络的分析**
- Step 1: 构建技术共现网络
- Step 2: 社区检测识别技术簇
- Step 3: 结构洞分析找技术空白

**方案 B：基于时间的分析**
- Step 1: 时间序列聚类
- Step 2: 趋势突变检测
- Step 3: 新兴技术识别

**方案 C：基于语义的分析**
- Step 1: Word2Vec 语义嵌入
- Step 2: DBSCAN 密度聚类
- Step 3: 低密度区域识别

## 进一步优化建议

### 1. 用户偏好学习
- 记录用户对不同方案的反馈
- 根据历史偏好调整方案生成

### 2. 多方案生成
- 一次生成 2-3 个不同的方案
- 让用户选择最合适的

### 3. 方法库扩展
- 定期更新可用方法列表
- 添加最新的分析技术

### 4. 知识图谱增强
- 丰富知识图谱中的案例
- 提供更多样化的参考

## 测试建议

运行相同的用户目标 3-5 次，观察：
1. 方案是否有明显差异
2. 方法选择是否合理
3. 是否仍然保持可执行性

如果方案仍然过于相似，可以：
- 进一步提高 temperature（0.8-0.9）
- 在 prompt 中明确要求"生成与之前不同的方案"
- 添加随机种子变化
