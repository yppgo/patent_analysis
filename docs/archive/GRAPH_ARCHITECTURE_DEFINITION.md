# åŒå›¾è°±æ¶æ„å®šä¹‰æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ç›®çš„

æ˜ç¡®å®šä¹‰**å› æœå›¾è°±**å’Œ**æ–¹æ³•å›¾è°±**çš„ï¼š
1. æ ¸å¿ƒä½œç”¨å’Œå®šä½
2. æ•°æ®ç»“æ„å’Œå†…å®¹
3. äº§å‡ºå’Œè¾“å‡ºæ ¼å¼
4. æ¥å…¥æ–¹å¼å’Œä½¿ç”¨æ—¶æœº
5. åœ¨æ•´ä½“æµç¨‹ä¸­çš„ä½ç½®

## ğŸ¯ ç”¨æˆ·ä½¿ç”¨åœºæ™¯

### å…¸å‹ç”¨æˆ·è¾“å…¥
**é¢†åŸŸå…³é”®è¯** + **ç ”ç©¶æ„å›¾**

**ç¤ºä¾‹**:
- "æ•°æ®å®‰å…¨é¢†åŸŸçš„æŠ€æœ¯è¶‹åŠ¿åˆ†æ"
- "é‡å­è®¡ç®—é¢†åŸŸçš„æŠ€æœ¯ç©ºç™½è¯†åˆ«"
- "äººå·¥æ™ºèƒ½é¢†åŸŸçš„ç«äº‰æ ¼å±€åˆ†æ"

### ç³»ç»Ÿå®Œæ•´æµç¨‹
```
ç”¨æˆ·è¾“å…¥ï¼ˆé¢†åŸŸï¼‰
  â†“
Step 1: å› æœå›¾è°± â†’ ç”Ÿæˆç ”ç©¶å‡è®¾
  â†“
Step 2: å˜é‡æ˜ å°„ â†’ ç¡®å®šæ•°æ®å­—æ®µ
  â†“
Step 3: æ–¹æ³•å›¾è°± â†’ é€‰æ‹©åˆ†ææ–¹æ³•
  â†“
Step 4: ç”ŸæˆDAGä»»åŠ¡å›¾
  â†“
Step 5: å¤šæ™ºèƒ½ä½“ååŒæ‰§è¡Œ
  â†“
è¾“å‡º: ç ”ç©¶æŠ¥å‘Š
```

è¯¦ç»†åœºæ™¯è¯·å‚è€ƒ: `docs/USER_SCENARIO_DEFINITION.md`

---

## ğŸ¯ æ•´ä½“æ¶æ„æ¦‚è§ˆ

```
ç”¨æˆ·è¾“å…¥
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Strategist Agent                      â”‚
â”‚  (æˆ˜ç•¥è§„åˆ’å±‚ - å†³å®š"åšä»€ä¹ˆ"å’Œ"ä¸ºä»€ä¹ˆ")                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                                    â†“
ã€å› æœå›¾è°±ã€‘                          ã€æ–¹æ³•å›¾è°±ã€‘
å›ç­”"ä¸ºä»€ä¹ˆ"                          å›ç­”"æ€ä¹ˆåš"
æä¾›ç†è®ºå‡è®¾                          æä¾›æ–¹æ³•æ¡ˆä¾‹
    â†“                                    â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
         ã€å˜é‡æ˜ å°„å™¨ã€‘
         è¿æ¥ç†è®ºå’Œæ•°æ®
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Methodologist Agent                     â”‚
â”‚  (æŠ€æœ¯æ¶æ„å±‚ - å†³å®š"æ€ä¹ˆå®ç°")                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Coding Agent                          â”‚
â”‚  (ä»£ç å®ç°å±‚ - ç”Ÿæˆå…·ä½“ä»£ç )                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š å›¾è°± 1: å› æœå›¾è°±ï¼ˆCausal Ontologyï¼‰

### 1.1 æ ¸å¿ƒå®šä½
**å›ç­”é—®é¢˜**: "ä¸ºä»€ä¹ˆ"ï¼ˆWhyï¼‰- å˜é‡ä¹‹é—´çš„å› æœå…³ç³»

**ä½œç”¨å±‚çº§**: ç†è®ºå±‚ / å‡è®¾ç”Ÿæˆå±‚

**ä½¿ç”¨æ—¶æœº**: Strategist Agent ç”Ÿæˆç ”ç©¶æ–¹æ¡ˆæ—¶ï¼Œ**ç¬¬ä¸€æ­¥**ä½¿ç”¨

### 1.2 æ•°æ®æ¥æº
- **æ–‡ä»¶ä½ç½®**: `sandbox/static/data/causal_ontology_extracted.json`
- **æ•°æ®æ¥æº**: ä»50ç¯‡ä¸“åˆ©åˆ†æé¢†åŸŸå­¦æœ¯è®ºæ–‡ä¸­æŠ½å–
- **æŠ½å–æ–¹æ³•**: Claude PDFåˆ†æ + äººå·¥éªŒè¯

### 1.3 æ•°æ®ç»“æ„

```json
{
  "meta": {
    "total_variables": 30,
    "total_paths": 135,
    "extraction_source": "50ç¯‡ä¸“åˆ©åˆ†æé¢†åŸŸå­¦æœ¯è®ºæ–‡"
  },
  "variables": [
    {
      "id": "V03_rd_investment",
      "label": "ç ”å‘æŠ•èµ„å¼ºåº¦",
      "category": "input",
      "definition": "ç ”å‘æ”¯å‡ºå è¥æ”¶æ¯”ä¾‹",
      "measurement": {
        "metric": "rd_intensity",
        "formula": "R&D_expenditure / Revenue"
      }
    }
  ],
  "causal_paths": [
    {
      "path_id": "P02",
      "source": "V03_rd_investment",
      "target": "V16_tech_impact",
      "effect_type": "positive",
      "effect_size": "large",
      "mechanism": "ç ”å‘æŠ•èµ„è§„æ¨¡ç›´æ¥å½±å“ä¸“åˆ©ç”³è¯·æ•°é‡å’ŒæŠ€æœ¯äº§å‡ºèƒ½åŠ›",
      "evidence": {
        "validated": true,
        "evidence_count": 14,
        "supporting_papers": ["è®ºæ–‡1", "è®ºæ–‡2", ...]
      }
    }
  ]
}
```

### 1.4 æ ¸å¿ƒäº§å‡º

| äº§å‡ºé¡¹ | å†…å®¹ | æ ¼å¼ | ç”¨é€” |
|--------|------|------|------|
| **ç ”ç©¶å‡è®¾** | åŸºäºå› æœè·¯å¾„çš„å‡è®¾åˆ—è¡¨ | List[Dict] | æŒ‡å¯¼ç ”ç©¶è®¾è®¡ |
| **å˜é‡å®šä¹‰** | 30ä¸ªæŠ½è±¡å˜é‡çš„å®šä¹‰å’Œæµ‹é‡æ–¹å¼ | Dict | æ˜ç¡®ç ”ç©¶å˜é‡ |
| **å› æœè·¯å¾„** | 135æ¡å› æœå…³ç³»ï¼ˆ42æ¡å·²éªŒè¯ï¼‰ | List[Dict] | ç†è®ºæ”¯æ’‘ |
| **ä¸­ä»‹è·¯å¾„** | Aâ†’Mâ†’Bçš„ä¸­ä»‹æ•ˆåº”è·¯å¾„ | List[Dict] | æ­ç¤ºä½œç”¨æœºåˆ¶ |
| **æ–‡çŒ®è¯æ®** | æ¯æ¡è·¯å¾„çš„æ”¯æŒæ–‡çŒ® | List[str] | æä¾›å¯ä¿¡åº¦ |

### 1.5 æ¥å…¥æ–¹å¼

**æ¥å…¥ç»„ä»¶**: `src/utils/causal_graph_query.py` - CausalGraphQueryç±»

**æ ¸å¿ƒæ–¹æ³•**:
```python
from src.graphs.causal_graph_query import CausalGraphQuery

query = CausalGraphQuery()

# 1. æŸ¥æ‰¾ç›´æ¥å› æœè·¯å¾„
path = query.find_direct_path("V03_rd_investment", "V16_tech_impact")

# 2. æŸ¥æ‰¾ä¸­ä»‹è·¯å¾„
mediation = query.get_mediation_paths("V03_rd_investment", "V16_tech_impact")

# 3. æ¨èç ”ç©¶å‡è®¾
hypotheses = query.suggest_hypotheses("ç ”ç©¶ç ”å‘æŠ•èµ„çš„å½±å“", top_k=5)

# 4. è·å–å˜é‡å®šä¹‰
variable = query.get_variable("V03_rd_investment")
```

### 1.6 ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | è¾“å…¥ | è¾“å‡º | ç¤ºä¾‹ |
|------|------|------|------|
| **å‡è®¾é©±åŠ¨ç ”ç©¶** | ç”¨æˆ·ç ”ç©¶ç›®æ ‡ | ç›¸å…³å› æœè·¯å¾„ + æ–‡çŒ®è¯æ® | "ç ”ç©¶ç ”å‘æŠ•èµ„å¯¹æŠ€æœ¯å½±å“åŠ›çš„å½±å“" â†’ V03â†’V16è·¯å¾„ |
| **æ¢ç´¢æ€§ç ”ç©¶** | ç›®æ ‡å˜é‡ | æ‰€æœ‰æŒ‡å‘è¯¥å˜é‡çš„è·¯å¾„ | "æ¢ç´¢å½±å“æŠ€æœ¯å½±å“åŠ›çš„å› ç´ " â†’ 14æ¡è·¯å¾„æŒ‡å‘V16 |
| **ç†è®ºè¿ç§»** | ç†è®ºå…³é”®è¯ | ç›¸å…³å› æœæœºåˆ¶ | "å¼€æ”¾å¼åˆ›æ–°" â†’ V04â†’V09â†’V16è·¯å¾„ |
| **ä¸­ä»‹æ•ˆåº”åˆ†æ** | æºå˜é‡ + ç›®æ ‡å˜é‡ | ä¸­ä»‹è·¯å¾„åˆ—è¡¨ | V03â†’V16 â†’ æ‰¾åˆ°4æ¡ä¸­ä»‹è·¯å¾„ |

### 1.7 è¾“å‡ºç¤ºä¾‹

```python
# è¾“å‡º: ç ”ç©¶å‡è®¾
{
  "hypothesis": "H1: ç ”å‘æŠ•èµ„å¼ºåº¦å¯¹æŠ€æœ¯å½±å“åŠ›æœ‰æ­£å‘å½±å“",
  "source_var": "V03_rd_investment",
  "target_var": "V16_tech_impact",
  "effect_type": "positive",
  "effect_size": "large",
  "mechanism": "ç ”å‘æŠ•èµ„è§„æ¨¡ç›´æ¥å½±å“ä¸“åˆ©ç”³è¯·æ•°é‡å’ŒæŠ€æœ¯äº§å‡ºèƒ½åŠ›",
  "evidence_count": 14,
  "supporting_papers": ["è®ºæ–‡1", "è®ºæ–‡2", ...]
}
```

---

## ğŸ”§ å›¾è°± 2: æ–¹æ³•å›¾è°±ï¼ˆMethodology Graphï¼‰

### 2.1 æ ¸å¿ƒå®šä½
**å›ç­”é—®é¢˜**: "æ€ä¹ˆåš"ï¼ˆHowï¼‰- å…·ä½“çš„åˆ†ææ–¹æ³•å’Œæ­¥éª¤

**ä½œç”¨å±‚çº§**: æ–¹æ³•å±‚ / å®ç°å‚è€ƒå±‚

**ä½¿ç”¨æ—¶æœº**: Strategist Agent ç”Ÿæˆç ”ç©¶æ–¹æ¡ˆæ—¶ï¼Œ**ç¬¬äºŒæ­¥**ä½¿ç”¨ï¼ˆåœ¨å› æœå›¾è°±ä¹‹åï¼‰

### 2.2 æ•°æ®æ¥æº
- **å­˜å‚¨ä½ç½®**: Neo4jæ•°æ®åº“ï¼ˆbolt://localhost:7687ï¼‰
- **æ•°æ®æ¥æº**: 66ç¯‡ä¸“åˆ©åˆ†æé¢†åŸŸå­¦æœ¯è®ºæ–‡çš„å®Œæ•´åˆ†æé€»è¾‘é“¾
- **æ•°æ®è§„æ¨¡**: 1023ä¸ªèŠ‚ç‚¹ï¼Œ2749ä¸ªå…³ç³»

### 2.3 æ•°æ®ç»“æ„ï¼ˆNeo4jå›¾æ•°æ®åº“ï¼‰

```
èŠ‚ç‚¹ç±»å‹:
- Paper (66ä¸ª): è®ºæ–‡èŠ‚ç‚¹
- AnalysisEvent (382ä¸ª): åˆ†ææ­¥éª¤èŠ‚ç‚¹
- Method (86ä¸ª): æ–¹æ³•èŠ‚ç‚¹
- Data (89ä¸ª): æ•°æ®å­—æ®µèŠ‚ç‚¹
- Conclusion (361ä¸ª): ç»“è®ºèŠ‚ç‚¹

å…³ç³»ç±»å‹:
- (Paper)-[:CONDUCTS]->(AnalysisEvent): è®ºæ–‡åŒ…å«åˆ†ææ­¥éª¤
- (AnalysisEvent)-[:EXECUTES]->(Method): æ­¥éª¤ä½¿ç”¨æ–¹æ³•
- (Data)-[:FEEDS_INTO]->(AnalysisEvent): æ•°æ®è¾“å…¥æ­¥éª¤
- (AnalysisEvent)-[:YIELDS]->(Conclusion): æ­¥éª¤äº§ç”Ÿç»“è®º
```

**å•ä¸ªæ¡ˆä¾‹ç»“æ„**:
```json
{
  "paper_title": "è®ºæ–‡æ ‡é¢˜",
  "paper_year": 2023,
  "full_logic_chain": [
    {
      "step_id": 1,
      "objective": "æ•°æ®æ”¶é›†ä¸é¢„å¤„ç†",
      "method_name": "æ•°æ®æ¸…æ´—",
      "method": "Data Cleaning",
      "config": {"tool": "Python", "library": "pandas"},
      "inputs": ["ä¸“åˆ©å·", "ç”³è¯·äºº", "IPCåˆ†ç±»"],
      "conclusion_type": "descriptive",
      "conclusion": "è·å¾—1000æ¡æ¸…æ´—åçš„ä¸“åˆ©æ•°æ®"
    },
    {
      "step_id": 2,
      "objective": "è¯†åˆ«æŠ€æœ¯ä¸»é¢˜",
      "method_name": "LDAä¸»é¢˜å»ºæ¨¡",
      "method": "LDA Topic Modeling",
      "config": {"n_topics": 8, "max_iter": 200},
      "inputs": ["æ‘˜è¦"],
      "conclusion_type": "analytical",
      "conclusion": "è¯†åˆ«å‡º8ä¸ªæŠ€æœ¯ä¸»é¢˜"
    }
  ]
}
```

### 2.4 æ ¸å¿ƒäº§å‡º

| äº§å‡ºé¡¹ | å†…å®¹ | æ ¼å¼ | ç”¨é€” |
|--------|------|------|------|
| **æ–¹æ³•æ¡ˆä¾‹** | å®Œæ•´çš„åˆ†æé€»è¾‘é“¾ | List[Dict] | æ–¹æ³•å‚è€ƒ |
| **æ–¹æ³•åç§°** | å…·ä½“çš„ç®—æ³•/å·¥å…·åç§° | str | æ–¹æ³•é€‰æ‹© |
| **é…ç½®å‚æ•°** | æ–¹æ³•çš„å‚æ•°è®¾ç½® | Dict | å‚æ•°å‚è€ƒ |
| **æ•°æ®è¾“å…¥** | éœ€è¦çš„æ•°æ®å­—æ®µ | List[str] | æ•°æ®å‡†å¤‡ |
| **ç»“è®ºç±»å‹** | è¾“å‡ºçš„ç»“è®ºç±»å‹ | str | ç»“æœè®¾è®¡ |

### 2.5 æ¥å…¥æ–¹å¼

**æ¥å…¥ç»„ä»¶**: `src/utils/neo4j_connector.py` - Neo4jConnectorç±»

**æ ¸å¿ƒæ–¹æ³•**:
```python
from src.utils.neo4j_connector import Neo4jConnector

neo4j = Neo4jConnector()

# 1. æ£€ç´¢æœ€ä½³å®è·µæ¡ˆä¾‹
cases = neo4j.retrieve_best_practices("æŠ€æœ¯è¶‹åŠ¿", limit=3)

# 2. æ‰§è¡Œè‡ªå®šä¹‰æŸ¥è¯¢
query = """
MATCH (p:Paper)-[:CONDUCTS]->(ae:AnalysisEvent)
WHERE ae.objective CONTAINS 'ä¸»é¢˜å»ºæ¨¡'
RETURN p.title, ae.method_name
"""
results = neo4j.run_query(query)

neo4j.close()
```

### 2.6 ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | è¾“å…¥ | è¾“å‡º | ç¤ºä¾‹ |
|------|------|------|------|
| **æ–¹æ³•é€‰æ‹©** | åˆ†æç›®æ ‡å…³é”®è¯ | ç›¸å…³æ–¹æ³•æ¡ˆä¾‹ | "ä¸»é¢˜è¯†åˆ«" â†’ LDAã€NMFæ¡ˆä¾‹ |
| **å‚æ•°å‚è€ƒ** | æ–¹æ³•åç§° | å‚æ•°é…ç½® | "LDA" â†’ n_topics=8, max_iter=200 |
| **æµç¨‹è®¾è®¡** | ç ”ç©¶ç±»å‹ | å®Œæ•´åˆ†ææµç¨‹ | "è¶‹åŠ¿åˆ†æ" â†’ 6æ­¥åˆ†ææµç¨‹ |
| **æ•°æ®éœ€æ±‚** | åˆ†ææ–¹æ³• | æ‰€éœ€æ•°æ®å­—æ®µ | "å¼•ç”¨åˆ†æ" â†’ ['å¼•ç”¨æ–‡çŒ®', 'è¢«å¼•ç”¨ä¸“åˆ©'] |

### 2.7 è¾“å‡ºç¤ºä¾‹

```python
# è¾“å‡º: æ–¹æ³•æ¡ˆä¾‹
{
  "paper_title": "A comprehensive review on green buildings research...",
  "paper_year": 2021,
  "full_logic_chain": [
    {
      "step_id": 1,
      "objective": "æ–‡çŒ®æ£€ç´¢",
      "method_name": "æ•°æ®åº“æ£€ç´¢",
      "inputs": ["å…³é”®è¯", "æ—¶é—´èŒƒå›´"],
      "conclusion": "è·å¾—2000ç¯‡æ–‡çŒ®"
    },
    {
      "step_id": 2,
      "objective": "æ–‡çŒ®è®¡é‡åˆ†æ",
      "method_name": "å¼•æ–‡åˆ†æ",
      "config": {"tool": "VOSviewer"},
      "inputs": ["å¼•ç”¨å…³ç³»"],
      "conclusion": "è¯†åˆ«æ ¸å¿ƒæ–‡çŒ®å’Œç ”ç©¶çƒ­ç‚¹"
    }
  ]
}
```

---

## ğŸ”— æ¡¥æ¢: å˜é‡æ˜ å°„å™¨ï¼ˆVariable Mapperï¼‰

### 3.1 æ ¸å¿ƒå®šä½
**å›ç­”é—®é¢˜**: "å¦‚ä½•è¿æ¥"ï¼ˆBridgeï¼‰- æŠ½è±¡å˜é‡åˆ°å…·ä½“æ•°æ®å­—æ®µçš„æ˜ å°„

**ä½œç”¨å±‚çº§**: å®ç°å±‚ / æ•°æ®å¯¹é½å±‚

**ä½¿ç”¨æ—¶æœº**: åœ¨å› æœå›¾è°±å’Œæ–¹æ³•å›¾è°±ä¹‹åï¼Œç”Ÿæˆå…·ä½“ä»»åŠ¡é…ç½®æ—¶ä½¿ç”¨

### 3.2 æ•°æ®æ¥æº
- **æ–‡ä»¶ä½ç½®**: `src/utils/variable_mapper.py` - å†…ç½®æ˜ å°„è¡¨
- **æ˜ å°„è§„æ¨¡**: 24ä¸ªå˜é‡å·²æ˜ å°„ï¼ˆ30ä¸ªå˜é‡ä¸­ï¼‰

### 3.3 æ˜ å°„ç»“æ„

```python
{
  "V03_rd_investment": {
    "label": "ç ”å‘æŠ•èµ„å¼ºåº¦",
    "data_fields": ["ç”³è¯·(ä¸“åˆ©æƒ)äºº", "åºå·"],
    "calculation": "COUNT(ä¸“åˆ©) / COUNT(DISTINCT ç”³è¯·äºº)",
    "calculation_type": "ratio",
    "python_code": "len(df) / df['ç”³è¯·(ä¸“åˆ©æƒ)äºº'].nunique()"
  }
}
```

### 3.4 æ ¸å¿ƒäº§å‡º

| äº§å‡ºé¡¹ | å†…å®¹ | æ ¼å¼ | ç”¨é€” |
|--------|------|------|------|
| **æ•°æ®å­—æ®µ** | å˜é‡å¯¹åº”çš„å®é™…åˆ—å | List[str] | æ•°æ®åŠ è½½ |
| **è®¡ç®—æ–¹æ³•** | å˜é‡çš„è®¡ç®—å…¬å¼ | str | ç®—æ³•è®¾è®¡ |
| **Pythonä»£ç ** | å¯æ‰§è¡Œçš„ä»£ç ç‰‡æ®µ | str | ä»£ç ç”Ÿæˆ |
| **æ•°æ®å¯ç”¨æ€§** | å­—æ®µæ˜¯å¦å­˜åœ¨ | bool | å¯è¡Œæ€§æ£€æŸ¥ |

### 3.5 æ¥å…¥æ–¹å¼

```python
from src.utils.variable_mapper import VariableMapper

mapper = VariableMapper()

# 1. è·å–æ•°æ®å­—æ®µ
fields = mapper.get_data_fields("V03_rd_investment")
# è¾“å‡º: ['ç”³è¯·(ä¸“åˆ©æƒ)äºº', 'åºå·']

# 2. è·å–è®¡ç®—æ–¹æ³•
calc = mapper.get_calculation_method("V03_rd_investment")
# è¾“å‡º: "COUNT(ä¸“åˆ©) / COUNT(DISTINCT ç”³è¯·äºº)"

# 3. æ£€æŸ¥æ•°æ®å¯ç”¨æ€§
available_columns = ["åºå·", "ç”³è¯·(ä¸“åˆ©æƒ)äºº", "IPCåˆ†ç±»å·"]
availability = mapper.check_data_availability("V03_rd_investment", available_columns)
# è¾“å‡º: {"is_available": True, "missing_columns": []}

# 4. ç”Ÿæˆä»»åŠ¡é…ç½®
config = mapper.generate_task_config("V03_rd_investment")
```

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### é˜¶æ®µ 1: ç”¨æˆ·è¾“å…¥
```
ç”¨æˆ·: "ç ”ç©¶ç ”å‘æŠ•èµ„å¯¹æŠ€æœ¯å½±å“åŠ›çš„å½±å“ï¼Œè€ƒè™‘æŠ€æœ¯å¤šæ ·æ€§çš„ä¸­ä»‹ä½œç”¨"
```

### é˜¶æ®µ 2: Strategist Agent å¤„ç†

#### Step 2.1: å› æœå›¾è°±æŸ¥è¯¢ï¼ˆç†è®ºå±‚ï¼‰
```python
# Strategist è°ƒç”¨å› æœå›¾è°±
causal_query = CausalGraphQuery()

# 2.1.1 æ¨èç ”ç©¶å‡è®¾
hypotheses = causal_query.suggest_hypotheses(user_goal, top_k=5)
# è¾“å‡º: [
#   {"path": V03â†’V16, "evidence_count": 14},
#   {"path": V03â†’V09â†’V16, "evidence_count": 8},
#   ...
# ]

# 2.1.2 è¯†åˆ«ä¸­ä»‹è·¯å¾„
mediation = causal_query.get_mediation_paths("V03", "V16")
# è¾“å‡º: [
#   {V03â†’V09â†’V16},
#   {V03â†’V13â†’V16},
#   ...
# ]
```

**äº§å‡º**: 
- ç†è®ºå‡è®¾åˆ—è¡¨
- å› æœè·¯å¾„ï¼ˆç›´æ¥ + ä¸­ä»‹ï¼‰
- æ–‡çŒ®è¯æ®

#### Step 2.2: å˜é‡æ˜ å°„ï¼ˆå®ç°å±‚ï¼‰
```python
# Strategist è°ƒç”¨å˜é‡æ˜ å°„å™¨
mapper = VariableMapper()

# 2.2.1 è·å–æ‰€éœ€æ•°æ®å­—æ®µ
required_fields = mapper.get_required_columns_for_hypothesis(
    source="V03",
    target="V16",
    mediators=["V09"]
)
# è¾“å‡º: ['ç”³è¯·(ä¸“åˆ©æƒ)äºº', 'åºå·', 'IPCåˆ†ç±»å·', 'è¢«å¼•ç”¨ä¸“åˆ©']

# 2.2.2 æ£€æŸ¥æ•°æ®å¯ç”¨æ€§
for var in ["V03", "V09", "V16"]:
    availability = mapper.check_data_availability(var, available_columns)
    # è¾“å‡º: {"is_available": True/False, "missing_columns": [...]}
```

**äº§å‡º**:
- æ‰€éœ€æ•°æ®å­—æ®µåˆ—è¡¨
- æ•°æ®å¯ç”¨æ€§æŠ¥å‘Š
- è®¡ç®—æ–¹æ³•è¯´æ˜

#### Step 2.3: æ–¹æ³•å›¾è°±æ£€ç´¢ï¼ˆæ–¹æ³•å±‚ï¼‰
```python
# Strategist è°ƒç”¨æ–¹æ³•å›¾è°±
neo4j = Neo4jConnector()

# 2.3.1 æå–å…³é”®è¯
keywords = ["ç ”å‘æŠ•èµ„", "æŠ€æœ¯å¤šæ ·æ€§", "ä¸­ä»‹æ•ˆåº”"]

# 2.3.2 æ£€ç´¢æ–¹æ³•æ¡ˆä¾‹
all_cases = []
for keyword in keywords:
    cases = neo4j.retrieve_best_practices(keyword, limit=2)
    all_cases.extend(cases)
# è¾“å‡º: [
#   {"paper": "è®ºæ–‡1", "logic_chain": [...]},
#   {"paper": "è®ºæ–‡2", "logic_chain": [...]},
#   ...
# ]
```

**äº§å‡º**:
- æ–¹æ³•æ¡ˆä¾‹åˆ—è¡¨
- å®Œæ•´åˆ†ææµç¨‹
- å‚æ•°é…ç½®å‚è€ƒ

#### Step 2.4: ç”ŸæˆDAGä»»åŠ¡å›¾
```python
# Strategist æ•´åˆä¸‰ä¸ªå›¾è°±çš„ä¿¡æ¯
blueprint = {
  "research_objective": "ç ”ç©¶ç ”å‘æŠ•èµ„å¯¹æŠ€æœ¯å½±å“åŠ›çš„å½±å“",
  "task_graph": [
    {
      "task_id": "task_1",
      "question": "å¦‚ä½•è®¡ç®—ç ”å‘æŠ•èµ„å¼ºåº¦ï¼Ÿ",
      "input_variables": [],
      "output_variables": ["V03_rd_investment"],
      "implementation_config": {
        "data_fields": ["ç”³è¯·(ä¸“åˆ©æƒ)äºº", "åºå·"],  # æ¥è‡ªå˜é‡æ˜ å°„å™¨
        "calculation": "COUNT(ä¸“åˆ©) / COUNT(DISTINCT ç”³è¯·äºº)",  # æ¥è‡ªå˜é‡æ˜ å°„å™¨
        "method": "èšåˆåˆ†æ"  # æ¥è‡ªæ–¹æ³•å›¾è°±
      }
    },
    {
      "task_id": "task_2",
      "question": "å¦‚ä½•è®¡ç®—æŠ€æœ¯å¤šæ ·æ€§ï¼Ÿ",
      "input_variables": [],
      "output_variables": ["V09_tech_diversity"],
      "implementation_config": {
        "data_fields": ["IPCåˆ†ç±»å·"],  # æ¥è‡ªå˜é‡æ˜ å°„å™¨
        "calculation": "Shannon Entropy",  # æ¥è‡ªå˜é‡æ˜ å°„å™¨
        "method": "ç†µè®¡ç®—"  # æ¥è‡ªæ–¹æ³•å›¾è°±
      }
    },
    {
      "task_id": "task_3",
      "question": "ç ”å‘æŠ•èµ„å¦‚ä½•é€šè¿‡æŠ€æœ¯å¤šæ ·æ€§å½±å“æŠ€æœ¯å½±å“åŠ›ï¼Ÿ",
      "input_variables": ["V03_rd_investment", "V09_tech_diversity"],
      "output_variables": ["mediation_result"],
      "dependencies": ["task_1", "task_2"],
      "implementation_config": {
        "method": "Baron & Kenny ä¸‰æ­¥æ³•",  # æ¥è‡ªæ–¹æ³•å›¾è°±
        "causal_hypothesis": "V03â†’V09â†’V16"  # æ¥è‡ªå› æœå›¾è°±
      }
    }
  ]
}
```

**äº§å‡º**: å®Œæ•´çš„DAGä»»åŠ¡å›¾

### é˜¶æ®µ 3: Methodologist Agent å¤„ç†

```python
# Methodologist æ¥æ”¶ task_node
for task in blueprint['task_graph']:
    spec = methodologist.process({'task_node': task})
    # ç”ŸæˆæŠ€æœ¯è§„æ ¼ï¼ˆä¼ªä»£ç ï¼‰
```

### é˜¶æ®µ 4: Coding Agent å¤„ç†

```python
# Coding Agent æ¥æ”¶ technical_spec
code = coding_agent.process({'spec': spec})
# ç”Ÿæˆå¯æ‰§è¡Œä»£ç 
```

---

## ğŸ“ ä½¿ç”¨è§„èŒƒ

### è§„èŒƒ 1: è°ƒç”¨é¡ºåº
```
1. å› æœå›¾è°±ï¼ˆç†è®ºå‡è®¾ï¼‰
   â†“
2. å˜é‡æ˜ å°„å™¨ï¼ˆæ•°æ®å¯¹é½ï¼‰
   â†“
3. æ–¹æ³•å›¾è°±ï¼ˆæ–¹æ³•å‚è€ƒï¼‰
   â†“
4. ç”Ÿæˆä»»åŠ¡å›¾
```

**ç¦æ­¢**: è·³è¿‡å› æœå›¾è°±ç›´æ¥ä½¿ç”¨æ–¹æ³•å›¾è°±

### è§„èŒƒ 2: æ•°æ®æµ
```
å› æœå›¾è°± â†’ å˜é‡ID (V03, V09, V16)
   â†“
å˜é‡æ˜ å°„å™¨ â†’ æ•°æ®å­—æ®µ (['ç”³è¯·äºº', 'IPC'])
   â†“
æ–¹æ³•å›¾è°± â†’ æ–¹æ³•åç§° ('LDA', 'èšç±»')
   â†“
ä»»åŠ¡é…ç½® â†’ å®Œæ•´é…ç½®
```

### è§„èŒƒ 3: é”™è¯¯å¤„ç†
- å› æœå›¾è°±æœªæ‰¾åˆ°è·¯å¾„ â†’ ä½¿ç”¨æ¢ç´¢æ€§åˆ†æ
- å˜é‡æ˜ å°„ç¼ºå¤±å­—æ®µ â†’ æ¨èæ›¿ä»£å˜é‡
- æ–¹æ³•å›¾è°±æ— ç›¸å…³æ¡ˆä¾‹ â†’ ä½¿ç”¨é€šç”¨æ–¹æ³•

---

## ğŸ¯ å…³é”®å†³ç­–ç‚¹

### å†³ç­–ç‚¹ 1: ä½•æ—¶ä½¿ç”¨å› æœå›¾è°±ï¼Ÿ
- âœ… ç”¨æˆ·æ˜ç¡®ç ”ç©¶å‡è®¾
- âœ… éœ€è¦ç†è®ºæ”¯æ’‘
- âœ… éªŒè¯æ€§ç ”ç©¶
- âŒ çº¯æ¢ç´¢æ€§åˆ†æï¼ˆå¯é€‰ï¼‰

### å†³ç­–ç‚¹ 2: ä½•æ—¶ä½¿ç”¨æ–¹æ³•å›¾è°±ï¼Ÿ
- âœ… éœ€è¦æ–¹æ³•å‚è€ƒ
- âœ… ä¸ç¡®å®šç”¨ä»€ä¹ˆç®—æ³•
- âœ… éœ€è¦å‚æ•°é…ç½®
- âŒ æ–¹æ³•å·²æ˜ç¡®ï¼ˆå¯è·³è¿‡ï¼‰

### å†³ç­–ç‚¹ 3: ä½•æ—¶ä½¿ç”¨å˜é‡æ˜ å°„å™¨ï¼Ÿ
- âœ… ä½¿ç”¨äº†å› æœå›¾è°±
- âœ… éœ€è¦æ•°æ®å­—æ®µ
- âœ… éœ€è¦è®¡ç®—æ–¹æ³•
- âŒ ä¸ä½¿ç”¨æŠ½è±¡å˜é‡ï¼ˆå¯è·³è¿‡ï¼‰

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| ç»„ä»¶ | å“åº”æ—¶é—´ | å‡†ç¡®ç‡ | è¦†ç›–ç‡ |
|------|---------|--------|--------|
| å› æœå›¾è°±æŸ¥è¯¢ | < 1ç§’ | 100% | 30å˜é‡/135è·¯å¾„ |
| å˜é‡æ˜ å°„å™¨ | < 1ç§’ | 100% | 24/30å˜é‡ |
| æ–¹æ³•å›¾è°±æ£€ç´¢ | < 2ç§’ | 100% | 66ç¯‡è®ºæ–‡ |

---

## ğŸ”§ ç»´æŠ¤å’Œæ‰©å±•

### å› æœå›¾è°±æ‰©å±•
1. æ·»åŠ æ–°å˜é‡ â†’ æ›´æ–° `causal_ontology_extracted.json`
2. æ·»åŠ æ–°è·¯å¾„ â†’ ä»æ–°æ–‡çŒ®ä¸­æŠ½å–
3. éªŒè¯è·¯å¾„ â†’ æ ‡è®° `validated: true`

### æ–¹æ³•å›¾è°±æ‰©å±•
1. æ·»åŠ æ–°è®ºæ–‡ â†’ å¯¼å…¥åˆ°Neo4j
2. æ·»åŠ æ–°æ–¹æ³• â†’ åˆ›å»ºMethodèŠ‚ç‚¹
3. æ›´æ–°é€»è¾‘é“¾ â†’ åˆ›å»ºå…³ç³»

### å˜é‡æ˜ å°„å™¨æ‰©å±•
1. æ·»åŠ æ–°æ˜ å°„ â†’ æ›´æ–° `DEFAULT_MAPPING`
2. æ·»åŠ Pythonä»£ç  â†’ æ›´æ–° `python_code` å­—æ®µ
3. å¯¼å‡ºé…ç½® â†’ ä½¿ç”¨ `export_mapping()`

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-19  
**ç»´æŠ¤è€…**: Patent Analysis Research Group  
**çŠ¶æ€**: âœ“ å·²å®šä¹‰æ¸…æ™°
